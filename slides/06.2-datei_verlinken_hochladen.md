# Integrationsszenarien #2 und #3

> Als **Nutzer** möchte ich in der Dateiauswahl in Moodle eine Datei aus meiner ownCloud Instanz **hochladen**.

<br>

> Als **Nutzer** möchte ich in der Dateiauswahl in Moodle eine Datei aus meiner ownCloud Instanz **verlinken**.

**Alle Moodle-Nutzer**
* Direkter Dateizugriff

---

## Implementierung: `repository_owncloud`

* Moodle Plugin-Typ: Repository

    * Schnittstellen, um auf Dateien aus externen Quellen zuzugreifen
    * Google Drive und Dropbox benutzen jetzt beide OAuth 2.0

    * Unterschied: Autorisierung, Authentifizierung und WebDAV im `oauth2owncloud` Plugin
    <aside class="notes">
        * Der wohl größte Unterschied wir haben die Authentifizierung in ein anderes Plugin ausgelagert.
        * Wer von Ihnen kennt den File Picker?

    </aside>

---

# Plugin Struktur

<div align="center">
	<img alt="Plugin Struktur" data-src="images/moodle/plugin-struktur-02.svg" width=70%>
</div>

---

## Nutzersicht

<div>
	<img alt="FilePicker" align="middle" data-src="images/SelectFilesredblock.png">
</div>
<div>
	<img alt="LeererFilePicker" src="images/LeererFilePicker.png">
</div>

---

## Schnittstelle: `lib.php`
* Erbt von abstrakter Klasse `repository`
* `print_login()`
    * Pop-up Window oder neuer Tab
* `check_login()`
* `supported_returntypes()`
* `get_file()` und `get_link()`
    * Leiten die Anfrage an das `oauth2owncloud` Plugin weiter
<aside class="notes">
      * und viele mehr...
      FILE_INTERNAL: Dateien dürfen im Moodle Dateien System hoch und runtergeladen werden.
      FILE_EXTERNAL: Dateien bleiben im externen Repository und werden von dort bezogen.
      FILE_REFERENCE: Dateien werden lokal erstellt, aber werden extern synchronisiert wenn notwendig.
</aside>

---

<h2> Schnittstelle: `lib.php`</h2>
<ul>
  <li>`get_listing()`</li>
  <ul>
      <li> Unterscheidet zwischen Dateien und Ordnern </li>
        <li> Dynamisches Laden von Inhalten </li>
      <li> Logout Button </li>
      <li> <em>Für den Admin:</em> Weiterleitung zu den Einstellungen</li>
      </ul>
</ul>

<div>
  <img alt="FilePicker" src="images/filepickerowncloud.png" width=60%>
</div>

---

<!-- .element: data-background-image="images/pixabay/photo-336376.jpg" data-state="dim-background" -->
<h1 onclick="window.open('https://sso.uni-muenster.de/PSLearnweb/ps_sciebo','_blank');">Demo</h1>

note:
* File Picker zeigen
  * Autorisierung des Zugriffes
  * Datei herunterladen
  * Datei verlinken
