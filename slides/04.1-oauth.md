# User Story #1

> **Als Nutzer möchte ich OAuth 2.0 benutzen können, um Moodle Zugriff auf ownCloud zu gewähren.**

<div style="text-align: left; float: left; padding-left:5%;">
  <p><b>ownCloud-Administrator:</b></p>
  <ul>
    <li>Clientregistrierung</li>
    <li>Log-Einträge</li>
  </ul>

  <p><b>Client-Entwickler:</b></p>
  <ul>
    <li>Authorization URL</li>
    <li>Access Token URL</li>
    <li>Zugriff auf die WebDAV Schnittstelle</li>
    <li>Zugriff auf die OCS Share API</li>
  </ul>

  <p><b>ownCloud-Nutzer:</b></p>
  <ul>
    <li>Verwaltung autorisierter Applikationen</li>
  </ul>
</div>

<div style="text-align: left; float: right; padding-right:10%;">
  <p><b>Moodle-Administrator:</b></p>
  <ul>
    <li>Clien-Daten verwalten</li>
    <li>Log-Einträge</li>
  </ul>
  <p><b>Moodle-Nutzer:</b></p>
  <ul>
    <li>Autorisierung von Moodle als Client</li>
  </ul>
</div>

---

# ownCloud

---

# Softwarearchitektur

<div align="left" style="padding-left:5%;">

**OAuth 2.0 App:** [owncloud/oauth2](https://github.com/owncloud/oauth2)

* Implementierung des OAuth 2.0 Authorization Code Flow

**Core Anpassungen:** [owncloud/core#26742](https://github.com/owncloud/core/pull/26742)

* Erweiterung der WebDAV Schnittstelle um OAuth 2.0
* Erweiterung der OCS Share API um OAuth 2.0

---

# OAuth 2.0 App

---

# Authorization Code Flow

<div align="center">
	<img alt="Authorization Code Flow" src="images/owncloud/authorization-code-flow.svg" width=85%>
</div>

---

# Datenmodell

<div align="center">
	<img alt="Datenmodell" src="images/owncloud/datenmodell.svg" width=64%>
</div>

---

# Schnittstellen

<div align="left" style="padding-left:5%;">

* **Authorization URL:** `/index.php/apps/oauth2/authorize`
	* `response_type` (für den Authorization Code Flow wird momentan nur `code` unterstützt)
	* `client_id`
	* `redirect_uri`
	* `state` (optional)
* **Access Token URL:** `/index.php/apps/oauth2/api/v1/token`
	* `grant_type` (entweder `authorization_code` oder `refresh_token`)
	* `code` und `redirect_uri` bzw. `refresh_token`

---

# Moodle

---

# Protokollablauf

<div align="center">
	<img alt="Protokollablauf" src="images/owncloud/protokollablauf.svg" width=90%>
</div>
